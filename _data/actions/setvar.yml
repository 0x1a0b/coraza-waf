name: setvar
description: |
  Special-purpose action that initializes the SESSION collection using the session token provided as parameter.
version: 0.1
actiongroup: Non-disruptive
supported: false
example: |
  SecRule REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/* "\bsys\.user_catalog\b" \
      "phase:2,rev:'2.1.3',capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,t:replaceComments,t:compressWhiteSpace,ctl:auditLogParts=+E, \
  block,msg:'Blind SQL Injection Attack',id:'959517',tag:'WEB_ATTACK/SQL_INJECTION',tag:'WASCTC/WASC-19',tag:'OWASP_TOP_10/A1',tag:'OWASP_AppSensor/CIE1', \
  tag:'PCI/6.5.2',logdata:'%{TX.0}',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.sql_injection_score=+%{tx.critical_anomaly_score}, \
  setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-WEB_ATTACK/SQL_INJECTION-%{matched_var_name}=%{tx.0}"
data: |
  To create a variable and set its value to 1 (usually used for setting flags), use: setvar:TX.score

  To create a variable and initialize it at the same time, use: setvar:TX.score=10

  To remove a variable, prefix the name with an exclamation mark: setvar:!TX.score

  To increase or decrease variable value, use + and - characters in front of a numerical value: setvar:TX.score=+5

  Note : When used in a chain this action will be executed when an individual rule matches and not the entire chain.This means that
  ```
  SecRule REQUEST_FILENAME "@contains /test.php" "chain,id:7,phase:1,t:none,nolog,setvar:tx.auth_attempt=+1" 
      SecRule ARGS_POST:action "@streq login" "t:none"
  ```
  Will increment every time that test.php is visited (regardless of the parameters submitted). If the desired goal is to set the variable only if the entire rule matches, it should be included in the last rule of the chain . For instance:
  ```
  SecRule REQUEST_FILENAME "@streq test.php" "chain,id:7,phase:1,t:none,nolog"
      SecRule ARGS_POST:action "@streq login" "t:none,setvar:tx.auth_attempt=+1"
  ```